<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>图片瀑布流</title>
	<style>
		* {
			margin: 0px;
			padding: 0px;
		}
		#container {
			position: relative;
		}
		.box{
			padding: 5px;
			float: left;
		}
		.box_img{
			padding: 5px;
			border: 1px solid #cccccc;
			box-shadow: 0 0 5px #cccccc;
			border-radius: 5px;
		}
		.box_img img {
			width: 150px;
			height: auto;
		}
	</style>
</head>
<body>
	<div id="container">
		<div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/2.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/5.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/3.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/4.jpg">
			</div>
		</div>
		<div class="box">
			<div class="box_img">
				<img src="img/6.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/7.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/8.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/9.jpg">
			</div>
		</div><div class="box">
			<div class="box_img">
				<img src="img/1.jpg">
			</div>
		</div>
	</div>
	<script>
		window.onload = function(){
			imgLocation("container","box");
			var imgDate = {"date":[{"src":"2.jpg"},{"src":"3.jpg"},{"src":"4.jpg"},{"src":"9.jpg"},{"src":"6.jpg"}]}
			window.onscroll = function(){
				if(checkFlag()){
					var cparent =document.getElementById("container");
					for(var i = 0;i<imgDate.date.length;i++){
						var ccontent =document.createElement("div");
						ccontent.className="box";
						cparent.appendChild(ccontent);
						var boxing = document.createElement("div");
						boxing.className="box_img";
						ccontent.appendChild(boxing);
						var img = document.createElement("img");
						img.src = "img/"+imgDate.date[i].src;
						boxing.appendChild(img);
					}
					imgLocation("container","box");
				}

			}
		}

		function checkFlag(){
			var cparent = document.getElementById("container");
			var ccontent = getChildElement(cparent,"box");
			var lastContentHeight = ccontent[ccontent.length-1].offsetTop;
			// console.log(lastContentHeight);
			var scrollTop = document.documentElement.scrollTop||document.body.scrollTop;
			console.log(scrollTop);
			var pageHeight = document.documentElement.clientHeight||document.body.clientHeight;
			// console.log(lastContentHeight+":"+scrollTop+":"+pageHeight);
			if(lastContentHeight<scrollTop+pageHeight){
				return true;
			}
		}

		function imgLocation(parent,content){
			//将parent下所有的content全部取出
			var cparent = document.getElementById(parent);
			var ccontent = getChildElement(cparent,content);
			// console.log(ccontent)
			var imgWidth = ccontent[0].offsetWidth;  //得到第一张图片的宽度
			//  （页面宽度/一张图片的宽度）  固定一排盛放的个数
			var cols = Math.floor(document.documentElement.clientWidth/imgWidth);  
			cparent.style.cssText = "width:"+imgWidth*cols+"px;margin:0 auto";

			//承载第一排盒子的高度
			var BoxHeightArr = [];
			for(var i = 0;i<ccontent.length;i++){
				// 存放图片的高度
				if(i<cols){
					BoxHeightArr[i] = ccontent[i].offsetHeight;
					// console.log(BoxHeightArr[i]);
				}else{
					var minheight = Math.min.apply(null,BoxHeightArr);
					// console.log(minheight);
					var minIndex = getminheightLocation(BoxHeightArr,minheight);

					ccontent[i].style.position = "absolute";
					ccontent[i].style.top = minheight+"px";
					ccontent[i].style.left = ccontent[minIndex].offsetLeft+"px";
					BoxHeightArr[minIndex] = BoxHeightArr[minIndex]+ccontent[i].offsetHeight;
				}
			}
		}


		function getminheightLocation(BoxHeightArr,minHeight){
			for(var i in BoxHeightArr){
				if(BoxHeightArr[i] == minHeight){
					return i;
				}
			}
		}

		function getChildElement(parent,content){
			var contentArr = [];
			var allcontent = parent.getElementsByTagName("*"); //得到所有内容
			for(var i = 0;i<allcontent.length;i++){
				if(allcontent[i].className==content){
					contentArr.push(allcontent[i]);  //追加到contentArr数组
				}
			}
			return contentArr;
		}
	</script>
</body>
</html>